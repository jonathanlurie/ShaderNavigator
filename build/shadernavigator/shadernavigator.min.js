var $jscomp={scope:{},inherits:function(e,l){function f(){}f.prototype=l.prototype;e.prototype=new f;e.prototype.constructor=e;for(var m in l)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(l,m);g&&Object.defineProperty(e,m,g)}else e[m]=l[m]}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,l,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[l]=f.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,l,f,m){if(l){f=$jscomp.global;e=e.split(".");for(m=0;m<e.length-1;m++){var g=e[m];g in f||(f[g]={});f=f[g]}e=e[e.length-1];m=f[e];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(f,e,{configurable:!0,writable:!0,value:l})}};
$jscomp.polyfill("Math.sign",function(e){return e?e:function(e){e=Number(e);return 0===e||isNaN(e)?e:0<e?1:-1}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var l=0;return $jscomp.iteratorPrototype(function(){return l<e.length?{done:!1,value:e[l++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(e,l){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var f=0,m={next:function(){if(f<e.length){var g=f++;return{value:l(g,e[g]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};
$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3");
(function(e,l){"object"===typeof exports&&"undefined"!==typeof module?l(exports):"function"===typeof define&&define.amd?define(["exports"],l):l(e.SHAD=e.SHAD||{})})(this,function(e){var l=function(){this._rePattern=/(\d)[\/]([-]?[0-9]*[.]?[0-9]+)[,]([-]?[0-9]*[.]?[0-9]+)[,]([-]?[0-9]*[.]?[0-9]+)[\/]([-]?[0-9]*[.]?[0-9]+)[,]([-]?[0-9]*[.]?[0-9]+)[,]([-]?[0-9]*[.]?[0-9]+)/g};l.prototype.getRawHash=function(){return window.location.hash.substr(1)};l.prototype.getHashInfo=function(){var a=this._rePattern.exec(this.getRawHash());
return a?{resolutionLvl:parseInt(a[1]),position:{x:parseFloat(a[2]),y:parseFloat(a[3]),z:parseFloat(a[4])},rotation:{x:parseFloat(a[5]),y:parseFloat(a[6]),z:parseFloat(a[7])}}:null};l.prototype.setHashInfo=function(a){isNaN(a.position.x)||isNaN(a.position.y)||isNaN(a.position.z)||isNaN(a.rotation.x)||isNaN(a.rotation.y)||isNaN(a.rotation.z)||(window.location.hash=a.resolutionLvl+"/"+a.position.x+","+a.position.y+","+a.position.z+"/"+a.rotation.x+","+a.rotation.y+","+a.rotation.z)};var f=function(a,
b,c){this._isPerspective=!1;this._objectSize=c;this._config=this._camera=null;this._near=.1;this._far=1E3;this._defaultFov=30;this._viewName="";this._originToLookAt=new THREE.Vector3(0,0,0);this._control=null;this._renderer=b;this._scene=a;this._mouse={x:0,y:0};this._mouseInView=!1;this._backgroundColor=null;this._windowSize={width:window.innerWidth,height:window.innerHeight}};f.prototype.setOriginToLookAt=function(a,b,c){this._originToLookAt.set(a,b,c)};f.prototype.initTopLeft=function(){this._config=
{left:0,bottom:.5,width:.5,height:.5,position:[-this._objectSize,0,0],up:[-1,0,0]};this._viewName="top_left";this._backgroundColor=(new THREE.Color).setRGB(.8,.8,.8)};f.prototype.initTopRight=function(){this._config={left:.5,bottom:.5,width:.5,height:.5,position:[0,-this._objectSize,0],up:[0,-1,0]};this._viewName="top_right";this._backgroundColor=(new THREE.Color).setRGB(.9,.9,.9)};f.prototype.initBottomLeft=function(){this._config={left:0,bottom:0,width:.5,height:.5,position:[0,0,-this._objectSize],
up:[0,1,0]};this._viewName="bottom_left";this._backgroundColor=(new THREE.Color).setRGB(.9,.9,.9)};f.prototype.initBottomRight=function(){this._config={left:.5,bottom:0,width:.5,height:.5,position:[-this._objectSize/2,this._objectSize/2,-this._objectSize/3],up:[0,0,-1]};this._viewName="bottom_right";this._backgroundColor=(new THREE.Color).setRGB(.97,.97,.97)};f.prototype.initOrthoCamera=function(){this._isPerspective=!1;this._camera=new THREE.OrthographicCamera(window.innerWidth/-360,window.innerWidth/
360,window.innerHeight/360,window.innerHeight/-360);this._camera.left_orig=window.innerWidth/-360;this._camera.right_orig=window.innerWidth/360;this._camera.top_orig=window.innerHeight/360;this._camera.bottom_orig=window.innerHeight/-360;this._initCameraSettings()};f.prototype.initPerspectiveCamera=function(){this._isPerspective=!0;this._camera=new THREE.PerspectiveCamera(this._defaultFov,window.innerWidth/window.innerHeight,this._near,this._far);this._initCameraSettings()};f.prototype._initCameraSettings=
function(){this._camera.position.x=this._config.position[0];this._camera.position.y=this._config.position[1];this._camera.position.z=this._config.position[2];this._camera.up.x=this._config.up[0];this._camera.up.y=this._config.up[1];this._camera.up.z=this._config.up[2];this._camera.fov=this._defaultFov;this._camera.lookAt(this._originToLookAt)};f.prototype.addTrackballControl=function(a,b){this._control=new THREE.TrackballControls(this._camera,b);this._control.rotateSpeed=5;this._control.staticMoving=
!0;this._control.zoomSpeed=.3;this._control.panSpeed=1;this._control.addEventListener("change",this.renderView.bind(this))};f.prototype.setBackgroundColor=function(a){this._backgroundColor=a};f.prototype.renderView=function(){var a=Math.floor(window.innerWidth*this._config.left),b=Math.floor(window.innerHeight*this._config.bottom),c=Math.floor(window.innerWidth*this._config.width),d=Math.floor(window.innerHeight*this._config.height);this._renderer.setViewport(a,b,c,d);this._renderer.setScissor(a,
b,c,d);this._renderer.setScissorTest(!0);this._renderer.setClearColor(this._backgroundColor);this._camera.aspect=c/d;this._camera.updateProjectionMatrix();this._renderer.render(this._scene,this._camera)};f.prototype.useRelativeCoordinatesOf=function(a){a.add(this._camera)};f.prototype.updateOrthoCamFrustrum=function(a){this._camera.left=this._camera.left_orig*a;this._camera.right=this._camera.right_orig*a;this._camera.top=this._camera.top_orig*a;this._camera.bottom=this._camera.bottom_orig*a};f.prototype.updateLookAt=
function(a){this._camera.lookAt(a.clone());this._control&&(this._control.target=a.clone())};f.prototype.updateControl=function(){this._control.update()};f.prototype.enableControl=function(){this._control&&!this._control.enabled&&(this._control.enabled=!0)};f.prototype.disableControl=function(){this._control&&this._control.enabled&&(this._control.enabled=!1)};f.prototype.isUsingControl=function(){return!!this._control};f.prototype.isInViewWindow=function(a,b){return a>this._config.left&&b>this._config.bottom&&
a<this._config.left+this._config.width&&b<this._config.bottom+this._config.height};f.prototype.enableLayer=function(a){this._camera.layers.enable(a)};f.prototype.disableLayer=function(a){this._camera.layers.disable(a)};f.prototype.getCamera=function(){return this._camera};f.prototype.updateRatio=function(a,b){this._isPerspective?(this._camera.aspect=a/b,this._camera.updateProjectionMatrix()):(a=this._windowSize.width/window.innerWidth,b=this._windowSize.height/window.innerHeight,this._camera.left/=
a,this._camera.right/=a,this._camera.top/=b,this._camera.bottom/=b);this._windowSize.width=window.innerWidth;this._windowSize.height=window.innerHeight};f.prototype.isPerspective=function(){return this._isPerspective};f.prototype.getConfigParam=function(a){if(a in this._config)return this._config[a];console.warn(a+" param does not exist in the config.");return null};var m=function(){};m.loadTextFile=function(a,b,c){var d="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
d.open("GET",a,!0);d.onload=function(){var a;4==d.readyState&&(a=d.status,200==a?b&&b(d.responseText):c&&c(a))};d.onerror=function(a){c&&c(status)};d.send()};m.loadCompressedTextFile=function(a,b,c){if(m.isPakoAvailable()){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(a){if(a=d.response){a=pako.inflate(a).buffer;a=new Blob([a]);var k=new FileReader;k.onload=function(a){b&&b(a.target.result)};k.onerror=function(a){c&&c(a)};k.readAsText(a)}};d.onerror=function(b){console.error("Can't find the file "+
a);c&&c(status)};d.send(null)}else c("Pako lib is not available, please include it to your project.")};m.isPakoAvailable=function(){var a=!0;try{pako}catch(b){console.warn(b),a=!1}return a};var g=function(a){this._textureChunk=a},B=function(a){this._textureChunk=a;return this};$jscomp.inherits(B,g);B.prototype._buildFileName=function(){var a=this._textureChunk.getIndex3D(),b=this._textureChunk.getVoxelPerSide(),c=this._textureChunk.getWorkingDir(),d=this._textureChunk.getResolutionLevel(),k=a[0]*
b,e=a[1]*b,a=a[2]*b;return c+"/"+d+"/"+k+"-"+(k+b)+"/"+e+"-"+(e+b)+"/"+a+"-"+(a+b)};B.prototype.loadTexture=function(){var a=this._buildFileName(),b=this,c=(new THREE.TextureLoader).load(a,function(){c.magFilter=THREE.NearestFilter;c.minFilter=THREE.NearestFilter;b._textureChunk.setTexture(c);b._textureChunk.onTextureSuccessToLoad()},function(){},function(){b._textureChunk.onTextureFailedToLoad()})};var t=function(a,b,c,d,k,e,f){this._chunkID=k;this._matrix3DSize=f;this._voxelPerSide=b;this._workingDir=
d;this._resolutionLevel=a;this._sizeWC=c;this._threeJsTexture=null;this._triedToLoad=this._textureLoadingError=this._isBuilt=!1;this._textureLoader=this._onTextureLoadErrorCallback=this._onTextureLoadedCallback=null;"precomputed_octree_tiles"==e&&(this._textureLoader=new B(this))};t.prototype.getVoxelPerSide=function(){return this._voxelPerSide};t.prototype.getIndex3D=function(){return this._index3D.slice()};t.prototype.getWorkingDir=function(){return this._workingDir};t.prototype.getResolutionLevel=
function(){return this._resolutionLevel};t.prototype.setTexture=function(a){this._threeJsTexture=a};t.prototype.buildFromIndex3D=function(a){this._index3D=a.slice();this._findChunkOrigin();this._triedToLoad||this._textureLoader.loadTexture();this._isBuilt=!0};t.prototype._findChunkOrigin=function(){this._originWC=new THREE.Vector3(this._index3D[0]*this._sizeWC,this._index3D[1]*this._sizeWC,this._index3D[2]*this._sizeWC)};t.prototype.onTextureSuccessToLoad=function(){this._textureLoadingError=!1;this._triedToLoad=
!0;this._onTextureLoadedCallback&&this._onTextureLoadedCallback(this._chunkID)};t.prototype.onTextureFailedToLoad=function(){this._threeJsTexture=null;this._triedToLoad=this._textureLoadingError=!0;this._onTextureLoadErrorCallback&&this._onTextureLoadErrorCallback(this._chunkID)};t.prototype._loadTextureDecode=function(){var a=this,b=new XMLHttpRequest;b.open("GET",this._filepath);b.responseType="arraybuffer";b.onload=function(){var c=new Uint8Array(b.response),d,k;k=new JpegDecoder;k.parse(c);c=
k.width;d=k.height;k=k.getData(c,d);a._threeJsTexture=new THREE.DataTexture(k,c,d,THREE.LuminanceFormat);a._threeJsTexture.magFilter=THREE.NearestFilter;a._threeJsTexture.minFilter=THREE.NearestFilter;a._threeJsTexture.flipY=!0;a._threeJsTexture.needsUpdate=!0;a._textureLoadingError=!1;a._triedToLoad=!0;a._onTextureLoadedCallback&&a._onTextureLoadedCallback(a._chunkID)};b.onerror=function(){a._threeJsTexture=null;a._textureLoadingError=!0;a._triedToLoad=!0;a._onTextureLoadErrorCallback&&a._onTextureLoadErrorCallback(a._chunkID)};
b.send()};t.prototype.getChunkTextureData=function(){return{texture:this._threeJsTexture,origin:this._originWC,valid:!this._textureLoadingError}};t.prototype.getTextureFilepath=function(){return this._filepath};t.prototype.loadingError=function(){return this._textureLoadingError};t.prototype.onTextureLoaded=function(a){this._onTextureLoadedCallback=a};t.prototype.onTextureLoadError=function(a){this._onTextureLoadErrorCallback=a};var u=function(a,b,c,d){this._chunks={};this._datatype=d;this._workingDir=
c;this._matrix3DSize=b;this._resolutionLevel=a;this._chunkSizeLvlZero=1;this._voxelPerSide=64;this._sizeChunkWC=this._chunkSizeLvlZero/Math.pow(2,this._resolutionLevel);this._createFakeTexture();this._chunkCounter={toBeLoaded:0,loaded:0,failled:0};this._onChunksLoadedCallback=null};u.prototype._initChunkFromIndex3D=function(a){var b=this,c=this.getKeyFromIndex3D(a);this._chunks[c]=new t(this._resolutionLevel,this._voxelPerSide,this._sizeChunkWC,this._workingDir,c,this._datatype,this._matrix3DSize);
this._chunks[c].onTextureLoaded(function(a){b._countChunks(a,!0)});this._chunks[c].onTextureLoadError(function(a){b._countChunks(a,!1)});this._chunks[c].buildFromIndex3D(a);this._chunkCounter.toBeLoaded++;return this._chunks[c]};u.prototype.getSizeChunkWc=function(){return this._sizeChunkWC};u.prototype.getTextureAtPosition=function(a){a=this.getIndex3DFromWorldPosition(a);return this.getTextureAtIndex3D(a)};u.prototype.getTextureAtIndex3D=function(a){var b=this._fakeTextureData;if(this.isWithinBounds(a)){var c=
this._getChunkIfInCollection(a);c||(c=this._initChunkFromIndex3D(a));c.loadingError()||(b=c.getChunkTextureData())}return b};u.prototype.getIndex3DFromWorldPosition=function(a){return[Math.floor(a[0]/this._sizeChunkWC),Math.floor(a[1]/this._sizeChunkWC),Math.floor(a[2]/this._sizeChunkWC)]};u.prototype.isInCollection=function(a){return this.getKeyFromIndex3D(a)in this._chunks};u.prototype._getChunkIfInCollection=function(a){a=this.getKeyFromIndex3D(a);return a in this._chunks?this._chunks[a]:null};
u.prototype.getKeyFromIndex3D=function(a){return a.join("_")};u.prototype.isWithinBounds=function(a){return 0>a[0]||a[0]>=this._matrix3DSize[0]||0>a[1]||a[1]>=this._matrix3DSize[1]||0>a[2]||a[2]>=this._matrix3DSize[2]?!1:!0};u.prototype._createFakeTexture=function(){this._fakeTextureData={texture:new THREE.DataTexture(new Uint8Array(1),1,1,THREE.LuminanceFormat,THREE.UnsignedByteType),origin:new THREE.Vector3(0,0,0),validity:!1}};u.prototype._get8ClosestToPositions=function(a){var b=this.getIndex3DFromWorldPosition(a);
a=[Math.abs(a[0]%this._sizeChunkWC)>this._sizeChunkWC/2?b[0]+Math.sign(a[0]):b[0]-Math.sign(a[0]),Math.abs(a[1]%this._sizeChunkWC)>this._sizeChunkWC/2?b[1]+Math.sign(a[1]):b[1]-Math.sign(a[1]),Math.abs(a[2]%this._sizeChunkWC)>this._sizeChunkWC/2?b[2]+Math.sign(a[2]):b[2]-Math.sign(a[2])];return[[b[0],b[1],b[2]],[b[0],b[1],a[2]],[b[0],a[1],b[2]],[b[0],a[1],a[2]],[a[0],b[1],b[2]],[a[0],b[1],a[2]],[a[0],a[1],b[2]],[a[0],a[1],a[2]]]};u.prototype.get8ClosestTextureData=function(a){var b=0,c=[],d=[],k=
[],e=[],f=this;this._get8ClosestToPositions(a).forEach(function(a){a=f.getTextureAtIndex3D(a);a.valid?(c.push(a.texture),k.push(a.origin)):(d.push(a.texture),e.push(a.origin))});b=c.length;return{textures:c.concat(d),origins:k.concat(e),nbValid:b}};u.prototype._countChunks=function(a,b){this._chunkCounter.loaded+=+b;this._chunkCounter.failled+=+!b;this._chunkCounter.loaded+this._chunkCounter.failled==this._chunkCounter.toBeLoaded&&console.log("\x3e\x3e All required chunks are loaded");this._onChunksLoadedCallback&&
this._onChunksLoadedCallback(this._resolutionLevel,this._chunkCounter.toBeLoaded-this._chunkCounter.loaded-this._chunkCounter.failled)};u.prototype.onChunkLoaded=function(a){this._onChunksLoadedCallback=a};var p=function(){this._chunkCollections=[];this._workingDir="";this._resolutionLevel=0;this._boundingBox=this.onReadyCallback=null;this._chunkSize=[64,64,64];this._onChunksLoadedCallback=this._levelsInfo=this._onConfigErrorCallback=null};p.prototype.onReady=function(a){this.onReadyCallback=a};p.prototype.loadConfig=
function(a){var b=this,c=a.url;m.loadTextFile(c,function(d){b._workingDir=c.substring(0,Math.max(c.lastIndexOf("/"),c.lastIndexOf("\\")));b._loadConfigDescription(a.datatype,JSON.parse(d))},function(a){console.error("Could not load config file "+c);b._onConfigErrorCallback&&b._onConfigErrorCallback(c,0)})};p.prototype._loadConfigDescription=function(a,b){var c=this;this._levelsInfo=b.scales;0<this._levelsInfo.length&&this._levelsInfo.sort(function(a,b){return a.resolution[0]>b.resolution[0]?-1:1});
this._determineChunkSize();this._computeBoundingBox();this._levelsInfo.forEach(function(b,k){c._addChunkCollectionLevel(k,b.size,a)});if(this.onReadyCallback)this.onReadyCallback()};p.prototype._addChunkCollectionLevel=function(a,b,c){a=new u(a,[Math.ceil(b[0]/this._chunkSize[0]),Math.ceil(b[1]/this._chunkSize[1]),Math.ceil(b[2]/this._chunkSize[2])],this._workingDir,c);if(this._onChunksLoadedCallback)a.onChunkLoaded(this._onChunksLoadedCallback);this._chunkCollections.push(a)};p.prototype.onChunkLoaded=
function(a){this._onChunksLoadedCallback=a};p.prototype.setResolutionLevel=function(a){a=Math.round(a);0<=a&&a<this._chunkCollections.length&&(this._resolutionLevel=a)};p.prototype.getCurrentResolutionLevel=function(){return this._resolutionLevel};p.prototype.getCurrentChunkSizeWc=function(){return this._chunkCollections[this._resolutionLevel].getSizeChunkWc()};p.prototype.getChunkSizeWcByLvl=function(a){return this._chunkCollections[a].getSizeChunkWc()};p.prototype.get8ClosestTextureData=function(a){return this._chunkCollections[this._resolutionLevel].get8ClosestTextureData(a)};
p.prototype.get8ClosestTextureDataByLvl=function(a,b){return this._chunkCollections[b].get8ClosestTextureData(a)};p.prototype._determineChunkSize=function(){this._chunkSize=this._levelsInfo[0].chunk_sizes[0]};p.prototype._computeBoundingBox=function(){this._boundingBox=[this._levelsInfo[0].size[0]/64,this._levelsInfo[0].size[1]/64,this._levelsInfo[0].size[2]/64]};p.prototype.getBoundingBox=function(){return this._boundingBox.slice()};p.prototype.isInside=function(a,b,c){return 0<a&&a<this._boundingBox[0]&&
0<b&&b<this._boundingBox[1]&&0<c&&c<this._boundingBox[2]};p.prototype.onConfigError=function(a){this._onConfigErrorCallback=a};p.prototype.getLevelInfo=function(a,b){if(0<=a&&a<this._levelsInfo.length&&b in this._levelsInfo[a])return this._levelsInfo[a][b]};var y=function(a){this._sphere=new THREE.Object3D;var b=new THREE.CircleGeometry(a,64),c=new THREE.CircleGeometry(a,64),d=new THREE.CircleGeometry(a,64),k=new THREE.LineBasicMaterial({color:16724787,linewidth:1.5}),e=new THREE.LineBasicMaterial({color:60238,
linewidth:1.5}),f=new THREE.LineBasicMaterial({color:35071,linewidth:1.5});b.vertices.shift();c.vertices.shift();d.vertices.shift();k=new THREE.Line(b,k);k.name="xCircle";b.rotateY(Math.PI/2);b=new THREE.Line(c,e);b.name="yCircle";c.rotateX(-Math.PI/2);c=new THREE.Line(d,f);c.name="zCircle";this._sphere=new THREE.Object3D;this._sphere.add(k);this._sphere.add(b);this._sphere.add(c);c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-a,0,0),new THREE.Vector3(a,0,0));c=new THREE.Line(c,new THREE.LineBasicMaterial({color:16724787,
linewidth:1.5}));d=new THREE.Geometry;d.vertices.push(new THREE.Vector3(0,-a,0),new THREE.Vector3(0,a,0));d=new THREE.Line(d,new THREE.LineBasicMaterial({color:60238,linewidth:1.5}));f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,0,-a),new THREE.Vector3(0,0,a));f=new THREE.Line(f,new THREE.LineBasicMaterial({color:35071,linewidth:1.5}));this._sphere.add(c);this._sphere.add(d);this._sphere.add(f);f=new THREE.TextureLoader;c=f.load("textures/left.png");k=f.load("textures/right.png");e=f.load("textures/anterior.png");
b=f.load("textures/posterior.png");d=f.load("textures/superior.png");f=f.load("textures/inferior.png");c=new THREE.Sprite(new THREE.SpriteMaterial({map:c}));k=new THREE.Sprite(new THREE.SpriteMaterial({map:k}));e=new THREE.Sprite(new THREE.SpriteMaterial({map:e}));b=new THREE.Sprite(new THREE.SpriteMaterial({map:b}));d=new THREE.Sprite(new THREE.SpriteMaterial({map:d}));f=new THREE.Sprite(new THREE.SpriteMaterial({map:f}));a*=1.4;c.position.set(a,0,0);k.position.set(-a,0,0);e.position.set(0,a,0);
b.position.set(0,-a,0);d.position.set(0,0,-a);f.position.set(0,0,a);this._sphere.add(c);this._sphere.add(k);this._sphere.add(e);this._sphere.add(b);this._sphere.add(d);this._sphere.add(f);this._sphere.children.forEach(function(a){a.layers.enable(0);a.layers.enable(1)})};y.prototype.addTo=function(a){a.add(this._sphere)};y.prototype.rescale=function(a){this._sphere.scale.x=a;this._sphere.scale.y=a;this._sphere.scale.z=a};y.prototype.rescaleFromResolutionLvl=function(a){a=1/Math.pow(2,a);this._sphere.scale.x=
a;this._sphere.scale.y=a;this._sphere.scale.z=a};y.prototype.setPosition=function(a){this._sphere.position.x=a.x;this._sphere.position.y=a.y;this._sphere.position.z=a.z};y.prototype.toggle=function(){this._sphere.visible=!this._sphere.visible};y.prototype.setVisibility=function(a){this._sphere.visible=a};var r=function(a,b){this._quadViews=a;this._windowSize={width:window.innerWidth,height:window.innerHeight};this._domContainer=document.getElementById(void 0===b?"container":b);this._mouse={x:0,y:0};
this._mouseLastPosition={x:-1,y:-1};this._mouseDistance={x:0,y:0};this._indexViewMouseDown=this._indexCurrentView=-1;this._shiftKeyPressed=this._tKeyPressed=this._rKeyPressed=this._mousePressed=!1;this._domContainer.addEventListener("mousemove",this._onMouseMove.bind(this),!1);this._domContainer.addEventListener("mousedown",this._onMouseDown.bind(this),!1);this._domContainer.addEventListener("mouseup",this._onMouseUp.bind(this),!1);this._domContainer.addEventListener("keydown",this._onKeyDown.bind(this),
!1);this._domContainer.addEventListener("keyup",this._onKeyUp.bind(this),!1);this._multiplaneContainer=this._onDonePlayingCallback=this._onArrowDownCallback=this._onArrowUpCallback=this._onScrollViewCallback=this._onGrabViewTransverseRotateCallback=this._onGrabViewRotateCallback=this._onGrabViewTranslateCallback=null;this._raycaster=new THREE.Raycaster;this._onClickPlaneCallback={perspective:null,ortho:null}};r.prototype.updateWindowSize=function(a,b){this._windowSize.width=a;this._windowSize.height=
b;this._quadViews.forEach(function(a){a.updateRatio()})};r.prototype._onMouseMove=function(a){this._mouse.x=a.clientX/this._windowSize.width;this._mouse.y=1-a.clientY/this._windowSize.height;this._manageQuadViewsMouseActivity();if(this._mousePressed){this._mouseDistance.x=(this._mouse.x-this._mouseLastPosition.x)*this._windowSize.width/100;this._mouseDistance.y=(this._mouse.y-this._mouseLastPosition.y)*this._windowSize.height/100;if(this._rKeyPressed){var b={x:this._indexViewMouseDown%2*.5+.25,y:.5*
(1<this._indexViewMouseDown?0:1)+.25};a=(new THREE.Vector3(this._mouseLastPosition.x-b.x,this._mouseLastPosition.y-b.y,this._mouseLastPosition.z-b.z)).normalize();var c=(new THREE.Vector3(this._mouse.x-b.x,this._mouse.y-b.y,this._mouse.z-b.z)).normalize(),b=Math.acos(a.dot(c));a=Math.sign(a.cross(c).z);this._onGrabViewRotateCallback&&this._onGrabViewRotateCallback(b,a,this._indexViewMouseDown)}else this._tKeyPressed?this._onGrabViewTransverseRotateCallback&&this._onGrabViewTransverseRotateCallback(this._mouseDistance,
this._indexViewMouseDown):this._onGrabViewTranslateCallback&&this._onGrabViewTranslateCallback(this._mouseDistance,this._indexViewMouseDown);this._mouseLastPosition.x=this._mouse.x;this._mouseLastPosition.y=this._mouse.y}};r.prototype._onMouseDown=function(a){this._mousePressed=!0;this._indexViewMouseDown=this._indexCurrentView;this._shiftKeyPressed&&this._intersectMultiplane(a);this._mouseLastPosition.x=this._mouse.x;this._mouseLastPosition.y=this._mouse.y};r.prototype._onMouseUp=function(a){this._mousePressed=
!1;this._indexViewMouseDown=-1;this._mouseDistance.x=0;this._mouseDistance.y=0;this._onDonePlayingCallback&&this._onDonePlayingCallback()};r.prototype._onKeyDown=function(a){switch(a.key){case "r":this._rKeyPressed=!0;break;case "t":this._tKeyPressed=!0;break;case "Shift":this._shiftKeyPressed=!0;break;case "ArrowDown":this._onArrowDownCallback&&this._onArrowDownCallback(this._indexCurrentView);break;case "ArrowUp":this._onArrowUpCallback&&this._onArrowUpCallback(this._indexCurrentView)}};r.prototype._onKeyUp=
function(a){switch(a.key){case "r":this._rKeyPressed=!1;break;case "t":this._tKeyPressed=!1;break;case "Shift":this._shiftKeyPressed=!1}this._onDonePlayingCallback&&this._onDonePlayingCallback()};r.prototype._manageQuadViewsMouseActivity=function(){var a=this,b=this._mouse.x,c=this._mouse.y;this._quadViews.forEach(function(d,e){d.isInViewWindow(b,c)?(a._indexCurrentView=e,d.enableControl()):d.disableControl()})};r.prototype.onGrabViewTranslate=function(a){this._onGrabViewTranslateCallback=a};r.prototype.onGrabViewRotate=
function(a){this._onGrabViewRotateCallback=a};r.prototype.onGrabViewTransverseRotate=function(a){this._onGrabViewTransverseRotateCallback=a};r.prototype.onArrowDown=function(a){this._onArrowDownCallback=a};r.prototype.onArrowUp=function(a){this._onArrowUpCallback=a};r.prototype.onDonePlaying=function(a){this._onDonePlayingCallback=a};r.prototype.setMultiplaneContainer=function(a){this._multiplaneContainer=a};r.prototype._intersectMultiplane=function(){var a=1/this._quadViews[this._indexViewMouseDown].getConfigParam("width"),
b=1/this._quadViews[this._indexViewMouseDown].getConfigParam("height"),c=this._quadViews[this._indexViewMouseDown].getConfigParam("left"),d=this._quadViews[this._indexViewMouseDown].getConfigParam("bottom"),a=new THREE.Vector2(2*(this._mouse.x*a-c*a)-1,2*(this._mouse.y*b-d*b)-1);this._raycaster.setFromCamera(a,this._quadViews[this._indexViewMouseDown].getCamera());a=this._raycaster.intersectObject(this._multiplaneContainer,!0);a.length&&(this._quadViews[this._indexViewMouseDown].isPerspective()?this._onClickPlaneCallback.perspective&&
this._onClickPlaneCallback.perspective(a[0].point):this._onClickPlaneCallback.ortho&&this._onClickPlaneCallback.ortho(a[0].point))};r.prototype.onClickPlane=function(a,b){a in this._onClickPlaneCallback?this._onClickPlaneCallback[a]=b:console.warn('The camera type must be "perspective" or "ortho".')};var v=function(){this._defaultMapFolder="";this._colormapsToLoad=[];this._colormapSuccessCounter=0;this._colorMaps={};this._onColormapUpdateCallback=null;this._currentColormap={id:"none",colormap:null};
this._isEnabled=!1;this._textureLoader=new THREE.TextureLoader;this._colorMaps.none=null};v.prototype._loadColormap=function(a,b){b=void 0===b?!0:b;var c=this,d=(new String(a)).substring(a.lastIndexOf("/")+1);-1!=d.lastIndexOf(".")&&(d=d.substring(0,d.lastIndexOf(".")));this._textureLoader.load(a,function(a){c._colormapSuccessCounter++;c._colorMaps[d]=a;b&&(c._currentColormap.id=d,c._currentColormap.colormap=a);c._colormapSuccessCounter==c._colormapsToLoad.length&&c._onColormapUpdateCallback&&c._onColormapUpdateCallback()},
function(a){},function(b){console.error("Failed to load "+a)})};v.prototype.loadCollection=function(a){var b=this,c=a.url;m.loadTextFile(c,function(a){b._defaultMapFolder=c.substring(0,Math.max(c.lastIndexOf("/"),c.lastIndexOf("\\")))+"/";b._colormapsToLoad=JSON.parse(a);b._colormapsToLoad.forEach(function(a){b._loadColormap(b._defaultMapFolder+a,!1)})},function(){console.warn("Unable to load the colormap list file ( "+c+" ).")})};v.prototype.getCurrentColorMap=function(){return this._currentColormap};
v.prototype.isColormappingEnabled=function(){return this._isEnabled};v.prototype.enableColorMapping=function(){this._isEnabled=!0};v.prototype.disableColorMapping=function(){this._isEnabled=!1};v.prototype.getAvailableColormaps=function(){return Object.keys(this._colorMaps)};v.prototype.useColormap=function(a){return this._colorMaps.hasOwnProperty(a)?(this._currentColormap.id=a,this._currentColormap.colormap=this._colorMaps[a],"none"==a?this.disableColorMapping():this.enableColorMapping(),!0):!1};
v.prototype.onColormapUpdate=function(a){this._onColormapUpdateCallback=a};var q=function(a,b){this._plane=new THREE.Object3D;this._plane.name="projection plane";this._subPlaneSize=a/Math.sqrt(2);this._subPlanes=[];this._shaderMaterials=[];this._subPlaneDim={row:7,col:15};this._colormapManager=b;this._levelManager=null;this._resolutionLevel=0;this._buildSubPlanes()};q.prototype._buildSubPlanes=function(){for(var a=new THREE.PlaneBufferGeometry(this._subPlaneSize,this._subPlaneSize,1),b=new THREE.DataTexture(new Uint8Array(1),
1,1,THREE.LuminanceFormat,THREE.UnsignedByteType),c=new THREE.Vector3(0,0,0),b=new THREE.ShaderMaterial({uniforms:{nbChunks:{type:"i",value:0},textures:{type:"t",value:[b,b,b,b,b,b,b,b]},textureOrigins:{type:"v3v",value:[c,c,c,c,c,c,c,c]},chunkSize:{type:"f",value:1},colorMap:{type:"t",value:this._colormapManager.getCurrentColorMap().colormap},useColorMap:{type:"b",value:this._colormapManager.isColormappingEnabled()}},vertexShader:"uniform float chunkSize;\nuniform sampler2D colorMap;\nvarying vec2 vUv;\nvarying vec4 worldCoord;\nvoid main()\n{\n  vUv \x3d uv;\n  vec4 mvPosition \x3d modelViewMatrix * vec4( position, 1.0 );\n  gl_Position \x3d projectionMatrix * mvPosition;\n  worldCoord \x3d modelMatrix * vec4( position, 1.0 );\n}\n",
fragmentShader:"const int maxNbChunks \x3d 8;\nuniform int nbChunks;\nuniform sampler2D textures[maxNbChunks];\nuniform vec3 textureOrigins[maxNbChunks];\nuniform sampler2D colorMap;\nuniform bool useColorMap;\nuniform float chunkSize;\nvarying vec4 worldCoord;\nvarying vec2 vUv;\nbool isNan(float val)\n{\n  return (val \x3c\x3d 0.0 || 0.0 \x3c\x3d val) ? false : true;\n}\nbool isInsideChunk(in vec3 chunkPosition){\n  return !( chunkPosition.x\x3c0.0 || chunkPosition.x\x3e\x3d1.0 ||\n            chunkPosition.y\x3c0.0 || chunkPosition.y\x3e\x3d1.0 ||\n            chunkPosition.z\x3c0.0 || chunkPosition.z\x3e\x3d1.0 );\n}\nvoid getColorFrom3DTexture(in sampler2D texture, in vec3 chunkPosition, out vec4 colorFromTexture){\n  float numberOfImagePerStripY \x3d 64.0;\n  float numberOfPixelPerSide \x3d 64.0;\n  float yOffsetNormalized \x3d float(int(chunkPosition.z * numberOfImagePerStripY)) / numberOfImagePerStripY;\n  float stripX \x3d chunkPosition.x;\n  float stripY \x3d chunkPosition.y / numberOfImagePerStripY + yOffsetNormalized;\n  vec2 posWithinStrip \x3d vec2(stripX, stripY);\n  colorFromTexture \x3d texture2D(texture, posWithinStrip);\n}\nvec3 worldCoord2ChunkCoord(vec4 world, vec3 textureOrigin, float chunkSize){\n  vec3 chunkSystemCoordinate \x3d vec3((textureOrigin.x - world.x)*(-1.0)/chunkSize,\n                                    1.0 - (textureOrigin.y - world.y)*(-1.0)/chunkSize,\n                                    1.0 - (textureOrigin.z - world.z)*(-1.0)/chunkSize);\n  return chunkSystemCoordinate;\n}\nvoid main( void ) {\n  vec2 shaderPos \x3d vUv;\n  vec4 color \x3d vec4(1.0, 0.0 , 0.0, 1.0);\n  vec3 chunkPosition;\n  bool hasColorFromChunk \x3d false;\n  if(nbChunks \x3e\x3d 1){\n    chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[0], chunkSize);\n    if( isInsideChunk(chunkPosition) ){\n      getColorFrom3DTexture(textures[0], chunkPosition, color);\n      hasColorFromChunk \x3d true;\n    }\n    if(nbChunks \x3e\x3d 2){\n      chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[1], chunkSize);\n      if( isInsideChunk(chunkPosition) ){\n        getColorFrom3DTexture(textures[1], chunkPosition, color);\n        hasColorFromChunk \x3d true;\n      }\n      if(nbChunks \x3e\x3d 3){\n        chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[2], chunkSize);\n        if( isInsideChunk(chunkPosition) ){\n          getColorFrom3DTexture(textures[2], chunkPosition, color);\n          hasColorFromChunk \x3d true;\n        }\n        if(nbChunks \x3e\x3d 4){\n          chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[3], chunkSize);\n          if( isInsideChunk(chunkPosition) ){\n            getColorFrom3DTexture(textures[3], chunkPosition, color);\n            hasColorFromChunk \x3d true;\n          }\n          if(nbChunks \x3e\x3d 5){\n            chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[4], chunkSize);\n            if( isInsideChunk(chunkPosition) ){\n              getColorFrom3DTexture(textures[4], chunkPosition, color);\n              hasColorFromChunk \x3d true;\n            }\n            if(nbChunks \x3e\x3d 6){\n              chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[5], chunkSize);\n              if( isInsideChunk(chunkPosition) ){\n                getColorFrom3DTexture(textures[5], chunkPosition, color);\n                hasColorFromChunk \x3d true;\n              }\n              if(nbChunks \x3e\x3d 7){\n                chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[6], chunkSize);\n                if( isInsideChunk(chunkPosition) ){\n                  getColorFrom3DTexture(textures[6], chunkPosition, color);\n                  hasColorFromChunk \x3d true;\n                }\n                if(nbChunks \x3d\x3d 8){\n                  chunkPosition \x3d worldCoord2ChunkCoord(worldCoord, textureOrigins[7], chunkSize);\n                  if( isInsideChunk(chunkPosition) ){\n                    getColorFrom3DTexture(textures[7], chunkPosition, color);\n                    hasColorFromChunk \x3d true;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  if(hasColorFromChunk){\n    if(useColorMap){\n      vec2 colorToPosition \x3d vec2(color.r, 0.5);\n      vec4 colorFromColorMap \x3d texture2D(colorMap, colorToPosition);\n      if(colorFromColorMap.a \x3e 0.0){\n        gl_FragColor \x3d colorFromColorMap;\n      }else{\n        discard;\n      }\n    }else{\n      gl_FragColor \x3d color;\n    }\n  }else{\n    discard;\n  }\n}\n",
side:THREE.DoubleSide,transparent:!0}),c=0;c<this._subPlaneDim.row;c++)for(var d=0;d<this._subPlaneDim.col;d++){var e=b.clone(),f=new THREE.Mesh(a,e);f.position.set(-this._subPlaneDim.col*this._subPlaneSize/2+d*this._subPlaneSize+this._subPlaneSize/2,-this._subPlaneDim.row*this._subPlaneSize/2+c*this._subPlaneSize+this._subPlaneSize/2,0);this._plane.add(f);this._subPlanes.push(f);this._shaderMaterials.push(e)}};q.prototype.setLevelManager=function(a){this._levelManager=a};q.prototype.setMeshColor=
function(a){this._subPlanes[0].material.color=a};q.prototype.updateUniforms=function(){for(var a=this._subPlaneDim.row*this._subPlaneDim.col,b,c=0;c<a;c++)b=this._subPlanes[c].localToWorld(new THREE.Vector3(0,0,0)),b=this._levelManager.get8ClosestTextureDataByLvl([b.x,b.y,b.z],this._resolutionLevel),this._updateSubPlaneUniform(c,b)};q.prototype.printSubPlaneCenterWorld=function(){for(var a=this._subPlaneDim.row*this._subPlaneDim.col,b=0;b<a;b++)this._subPlanes[b].localToWorld(new THREE.Vector3(0,
0,0))};q.prototype._updateSubPlaneUniform=function(a,b){var c=this._levelManager.getChunkSizeWcByLvl(this._resolutionLevel);a=this._shaderMaterials[a].uniforms;a.nbChunks.value=b.nbValid;a.textures.value=b.textures;a.textureOrigins.value=b.origins;a.chunkSize.value=c;a.useColorMap.value=this._colormapManager.isColormappingEnabled();a.colorMap.value=this._colormapManager.getCurrentColorMap().colormap};q.prototype.getPlane=function(){return this._plane};q.prototype.updateScaleFromRezLvl=function(a){0>
a&&(a=0);this._resolutionLevel=a;a=1/Math.pow(2,this._resolutionLevel);this._plane.scale.x=a;this._plane.scale.y=a;this._plane.scale.z=a;this._plane.updateMatrixWorld();this.updateUniforms()};q.prototype.getWorldNormal=function(){return this._getWorldVectorNormalized(new THREE.Vector3(0,0,1))};q.prototype.getWorldVectorU=function(){return this._getWorldVectorNormalized(new THREE.Vector3(1,0,0))};q.prototype.getWorldVectorV=function(){return this._getWorldVectorNormalized(new THREE.Vector3(0,1,0))};
q.prototype._getWorldVectorNormalized=function(a){var b=(new THREE.Quaternion).copy(this._plane.quaternion);a=a.clone();a.applyQuaternion(b).normalize();return a};q.prototype.getWorldDiagonal=function(){return Math.sqrt(Math.pow(this._subPlaneDim.row,2)+Math.pow(this._subPlaneDim.col,2))*this._plane.scale.x};q.prototype.enableLayer=function(a){this._subPlanes.forEach(function(b){b.layers.enable(a)})};q.prototype.disableLayer=function(a){this._subPlanes.forEach(function(b){b.layers.disable(a)})};var h=
function(a,b){this._colormapManager=a;this._multiplaneContainer=new THREE.Object3D;this._multiplaneContainer.name="multiplane container";b.add(this._multiplaneContainer);this._projectionPlanesHiRez=[];this._projectionPlanesLoRez=[];this._addOrthoPlanes(this._projectionPlanesHiRez);this._addOrthoPlanes(this._projectionPlanesLoRez);this._onMultiplaneRotateCallback=this._onMultiplaneMoveCallback=null};h.prototype.onMultiplaneMove=function(a){this._onMultiplaneMoveCallback=a};h.prototype.onMultiplaneRotate=
function(a){this._onMultiplaneRotateCallback=a};h.prototype.getMultiplaneContainer=function(){return this._multiplaneContainer};h.prototype.setMultiplanePosition=function(a,b,c){this._multiplaneContainer.position.x=a;this._multiplaneContainer.position.y=b;this._multiplaneContainer.position.z=c;this.updateUniforms();this._onMultiplaneMoveCallback&&this._onMultiplaneMoveCallback(this._multiplaneContainer.position)};h.prototype.getMultiplanePosition=function(){return this._multiplaneContainer.position};
h.prototype.setMultiplaneRotation=function(a,b,c){this._multiplaneContainer.rotation.x=a;this._multiplaneContainer.rotation.y=b;this._multiplaneContainer.rotation.z=c;this.updateUniforms();this._onMultiplaneRotateCallback&&this._onMultiplaneRotateCallback()};h.prototype.getMultiplaneRotation=function(){return this._multiplaneContainer.rotation};h.prototype._addOrthoPlanes=function(a){var b=new q(1,this._colormapManager);b.setMeshColor(new THREE.Color(153));a.push(b);this._multiplaneContainer.add(b.getPlane());
b=new q(1,this._colormapManager);a.push(b);b.getPlane().rotateX(Math.PI/2);this._multiplaneContainer.add(b.getPlane());b=new q(1,this._colormapManager);b.setMeshColor(new THREE.Color(10027008));a.push(b);b.getPlane().rotateY(Math.PI/2);b.getPlane().rotateZ(Math.PI/2);this._multiplaneContainer.add(b.getPlane())};h.prototype.enableLayerHiRez=function(a){this._enableLayerPlaneArray(a,this._projectionPlanesHiRez)};h.prototype.enableLayerLoRez=function(a){this._enableLayerPlaneArray(a,this._projectionPlanesLoRez)};
h.prototype._enableLayerPlaneArray=function(a,b){b.forEach(function(b){b.enableLayer(a)})};h.prototype.disableLayerHiRez=function(a){this._disableLayerPlaneArray(a,this._projectionPlanesHiRez)};h.prototype.disableLayerLoRez=function(a){this._disableLayerPlaneArray(a,this._projectionPlanesLoRez)};h.prototype._disableLayerPlaneArray=function(a,b){b.forEach(function(b){b.disableLayer(a)})};h.prototype.setLevelManager=function(a){this._setLevelManagerPlaneArray(a,this._projectionPlanesHiRez);this._setLevelManagerPlaneArray(a,
this._projectionPlanesLoRez)};h.prototype._setLevelManagerPlaneArray=function(a,b){b.forEach(function(b){b.setLevelManager(a)})};h.prototype.updateScaleFromRezLvl=function(a){this._updateScaleFromRezLvlPlaneArray(a,this._projectionPlanesHiRez);this._updateScaleFromRezLvlPlaneArray(a-2,this._projectionPlanesLoRez)};h.prototype._updateScaleFromRezLvlPlaneArray=function(a,b){b.forEach(function(b){b.updateScaleFromRezLvl(a)})};h.prototype.updateUniforms=function(){this._updateUniformsPlaneArray(this._projectionPlanesHiRez);
this._updateUniformsPlaneArray(this._projectionPlanesLoRez)};h.prototype._updateUniformsPlaneArray=function(a){a.forEach(function(a){a.updateUniforms()})};h.prototype.getWorldDiagonalHiRez=function(){return this._projectionPlanesHiRez[0].getWorldDiagonal()};h.prototype.getWorldVectorN=function(a){return this._projectionPlanesHiRez[a].getWorldNormal()};h.prototype.getWorldVectorU=function(a){return this._projectionPlanesHiRez[a].getWorldVectorU()};h.prototype.getWorldVectorV=function(a){return this._projectionPlanesHiRez[a].getWorldVectorV()};
h.prototype._rotateMultiplane=function(a,b){a=this.getWorldVectorN(a);this._multiplaneContainer.rotateOnAxis(a,b);this.updateUniforms();this._onMultiplaneRotateCallback&&this._onMultiplaneRotateCallback()};h.prototype.rotateMultiplaneZ=function(a){this._rotateMultiplane(0,a)};h.prototype.rotateMultiplaneX=function(a){this._rotateMultiplane(2,a)};h.prototype.rotateMultiplaneY=function(a){this._rotateMultiplane(1,a)};h.prototype.translateMultiplaneX=function(a,b){this._translateMultiplane(2,a,b)};h.prototype.translateMultiplaneY=
function(a,b){this._translateMultiplane(1,a,b)};h.prototype.translateMultiplaneZ=function(a,b){this._translateMultiplane(0,a,b)};h.prototype._translateMultiplane=function(a,b,c){var d=this.getWorldVectorU(a);a=this.getWorldVectorV(a);this._multiplaneContainer.translateOnAxis(d,b);this._multiplaneContainer.translateOnAxis(a,c);this.updateUniforms();this._onMultiplaneMoveCallback&&this._onMultiplaneMoveCallback(this._multiplaneContainer.position)};var n=function(){this._shapeData=this._tempResult=this._stackIndex=
this._stack=null};n.prototype.copy=function(a){this._stack=a._stack;this._stackIndex=a._stackIndex;this._tempResult=a._tempResult;this._shapeData=a._shapeData};n.prototype.parse=function(a){this._parseRawData(a);this._arrangeData()};n.prototype._parseRawData=function(a){this._stack=a.trim().split(/\s+/).reverse();this._stackIndex=this._stack.length-1;this._tempResult={};a=this._popStack();var b,c,d,e,f,g;this._tempResult.split=!1;this._tempResult.type="P"===a?"polygon":"L"===a?"line":a;if("polygon"===
this._tempResult.type)this._parseSurfProp(),this._tempResult.numVertices=parseInt(this._popStack(),10),this._parseVertices(),this._parseNormals(),this._tempResult.nitems=parseInt(this._popStack(),10);else if("line"===this._tempResult.type)this._parseSurfProp(),this._tempResult.numVertices=parseInt(this._popStack(),10),this._parseVertices(),this._tempResult.nitems=parseInt(this._popStack(),10);else{this._tempResult.error=!0;this._tempResult.errorMessage='Invalid MNI Object class: must be "polygon" or "line"';
return}this._parseColors();this._parseEndIndices();this._parseIndices();if("polygon"!==this._tempResult.type&&"line"===this._tempResult.type){d=this._tempResult.indices;e=this._tempResult.endIndices;c=this._tempResult.nitems;for(var h=f=g=0;h<c;h++)b=0===h?0:e[h-1],a=e[h],f+=2*(a-b-1);f=new Uint32Array(f);for(h=0;h<c;h++){b=0===h?0:e[h-1];f[g++]=d[b];a=e[h];for(b+=1;b<a-1;b++)f[g++]=d[b],f[g++]=d[b];f[g++]=d[a-1]}this._tempResult.indices=f}};n.prototype._arrangeData=function(){this._shapeData={type:this._tempResult.type,
vertices:this._tempResult.vertices,normals:this._tempResult.normals,colors:this._tempResult.colors,surfaceProperties:this._tempResult.surfaceProperties,split:this._tempResult.split,error:this._tempResult.error,errorMessage:this._tempResult.errorMessage};var a=[this._shapeData.vertices.buffer,this._shapeData.colors.buffer];this._shapeData.normals&&a.push(this._shapeData.normals.buffer);this._shapeData.split?(this._shapeData.shapes=[{indices:this._tempResult.left.indices},{indices:this._tempResult.right.indices}],
a.push(this._tempResult.left.indices.buffer,this._tempResult.right.indices.buffer)):(this._shapeData.shapes=[{indices:this._tempResult.indices}],a.push(this._tempResult.indices.buffer));4===this._shapeData.colors.length&&this._unrollColors()};n.prototype._unrollColors=function(){var a,b,c,d,e=this._shapeData.vertices.length/3*4,f=new Uint8Array(e);a=this._shapeData.colors[0];b=this._shapeData.colors[1];c=this._shapeData.colors[2];d=this._shapeData.colors[3];for(var g=0;g<e;g+=4)f[g]=255*a,f[g+1]=
255*b,f[g+2]=255*c,f[g+3]=255*d;this._shapeData.colors=f};n.prototype._parseSurfProp=function(){"polygon"===this._tempResult.type?this._tempResult.surfaceProperties={ambient:parseFloat(this._popStack()),diffuse:parseFloat(this._popStack()),specularReflectance:parseFloat(this._popStack()),specularScattering:parseFloat(this._popStack()),transparency:parseFloat(this._popStack())}:"line"===this._tempResult.type&&(this._tempResult.surfaceProperties={width:this._popStack()})};n.prototype._parseVertices=
function(){for(var a=3*this._tempResult.numVertices,b=new Float32Array(a),c=0;c<a;c++)b[c]=parseFloat(this._popStack());this._tempResult.vertices=b};n.prototype._parseNormals=function(){for(var a=3*this._tempResult.numVertices,b=new Float32Array(a),c=0;c<a;c++)b[c]=parseFloat(this._popStack());this._tempResult.normals=b};n.prototype._parseColors=function(){var a=parseInt(this._popStack(),10),b,c;if(0===a){b=new Float32Array(4);for(var d=0;4>d;d++)b[d]=parseFloat(this._popStack())}else if(1===a)for(c=
4*this._tempResult.num_polygons,b=new Float32Array(c),d=0;d<c;d++)b[d]=parseFloat(this._popStack());else if(2===a)for(c=4*this._tempResult.numVertices,b=new Float32Array(c),d=0;d<c;d++)b[d]=parseFloat(this._popStack());else this._tempResult.error=!0,this._tempResult.errorMessage="Invalid color flag: "+a;this._tempResult.colorFlag=a;this._tempResult.colors=b};n.prototype._parseEndIndices=function(){for(var a=this._tempResult.nitems,b=new Uint32Array(a),c=0;c<a;c++)b[c]=parseInt(this._popStack(),10);
this._tempResult.endIndices=b};n.prototype._parseIndices=function(){for(var a=this._stackIndex+1,b=new Uint32Array(a),c=0;c<a;c++)b[c]=parseInt(this._popStack(),10);this._tempResult.indices=b};n.prototype._splitHemispheres=function(){var a=this._tempResult.indices.length;this._tempResult.left={indices:new Uint32Array(Array.prototype.slice.call(this._tempResult.indices,0,a/2))};this._tempResult.right={indices:new Uint32Array(Array.prototype.slice.call(this._tempResult.indices,a/2))}};n.prototype._popStack=
function(){return this._stack[this._stackIndex--]};n.prototype.getShapeData=function(){return this._shapeData};n.prototype.getNumberOfShapes=function(){return this._shapeData.shapes.length};n.prototype.getShapeRawIndices=function(a){return 0<=a&&a<this._shapeData.shapes.length?this._shapeData.shapes[a].indices:null};n.prototype.getRawVertices=function(){return this._shapeData.vertices};n.prototype.getRawNormals=function(){return this._shapeData.normals};n.prototype.getRawColors=function(){return this._shapeData.colors};
n.prototype.getSurfaceProperties=function(){return this._shapeData.surfaceProperties};var A=function(a,b){this._container=b;this._meshes={};this._collectionBox=this._configFileDir=null;this._readConfig(a)};A.prototype._readConfig=function(a){var b=this,c=a.url;m.loadTextFile(c,function(a){b._configFileDir=c.substring(0,Math.max(c.lastIndexOf("/"),c.lastIndexOf("\\")))+"/";b._loadConfigDescription(JSON.parse(a))},function(a){console.error("Could not load config file "+c);b._onConfigErrorCallback&&
b._onConfigErrorCallback(c,0)})};A.prototype._loadConfigDescription=function(a){var b=this;a.forEach(function(a){var c=a.url;"near"==a.urlType&&(c=b._configFileDir+c);m.loadTextFile(c,function(c){var d=new n;d.parse(c);c=b._buildMeshFromObjReader(d);c.geometry.computeBoundingBox();c.name=a.id;c.userData.longName=a.name;c.userData.description=a.description;"eulerAngle"in a&&c.rotation.set(a.eulerAngle[0],a.eulerAngle[1],a.eulerAngle[2]);"scale"in a&&c.scale.set(a.scale[0],a.scale[1],a.scale[2]);"position"in
a&&c.position.set(a.position[0],a.position[1],a.position[2]);c.layers.enable(0);c.layers.enable(1);b._meshes[a.id]=c;b._container.add(c);b._updateCollectionBox(c)},function(a){console.error("Could not load mesh file "+c)})})};A.prototype._buildMeshFromObjReader=function(a){var b=new THREE.BufferGeometry,c=a.getShapeRawIndices(0),d=a.getRawVertices(),e=a.getRawNormals(),f=a.getRawColors();b.setIndex(new THREE.BufferAttribute(c,1));b.addAttribute("position",new THREE.BufferAttribute(d,3));b.addAttribute("normal",
new THREE.BufferAttribute(e,3,!0));b.addAttribute("color",new THREE.BufferAttribute(f,4,!0));b.computeBoundingSphere();a=new THREE.MeshPhongMaterial({specular:16777215,shininess:250,side:THREE.DoubleSide,vertexColors:THREE.VertexColors,transparent:!0,opacity:a.getSurfaceProperties().transparency});return new THREE.Mesh(b,a)};A.prototype._updateCollectionBox=function(a){this._collectionBox?this._collectionBox.union(a.geometry.boundingBox):this._collectionBox=a.geometry.boundingBox.clone()};var x=function(a){this._quadScene=
a;this._resolutionLevel=this._quadScene.getResolutionLevel();this._resolutionLvlRange=[0,6];this._resolutionLvlSliderBuilt=!1;this._resolutionDescription="";this._colormapManager=this._quadScene.getColormapManager();this._colormapManager.onColormapUpdate(this._updateColormapList.bind(this));this._mainPanel=QuickSettings.create(window.innerWidth-250,0,document.title);this._initMainPanel()};x.prototype._initMainPanel=function(){var a=this;this._mainPanel.addBoolean("Compass",1,function(b){a._quadScene.getOrientationHelper().setVisibility(b)});
this._mainPanel.addBoolean("Bounding box",1,function(b){a._quadScene.getBoundingBoxHelper().setVisibility(b)});document.getElementById("Bounding box").parentElement.parentElement.style["margin-top"]="0px";this._mainPanel.addRange("Zoom level",0,6,0,1,function(b){b=Math.floor(b);a._updateResolutionDescription(b,a._quadScene.getLevelManager().getLevelInfo(a._resolutionLevel,"key")+" \u27a4 ")},function(b){b=Math.floor(b);a._resolutionLevel=b;a._quadScene.setResolutionLevel(b)});this._mainPanel.addText("Resolution",
"");this._mainPanel.overrideStyle("Resolution","background-color","transparent");document.getElementById("Resolution").readOnly=!0;document.getElementById("Resolution").parentElement.style["margin-top"]="0px";this._mainPanel.addText("Position","",function(){});this._mainPanel.overrideStyle("Position","text-align","center");this._mainPanel.addText("Rotation","",function(){});this._mainPanel.overrideStyle("Rotation","margin-top","0px");this._mainPanel.overrideStyle("Rotation","text-align","center");
document.getElementById("Rotation").parentElement.style["margin-top"]="0px";this._mainPanel.addButton("Apply",function(){var b=a._mainPanel.getValue("Position").split(",").map(function(a){return parseFloat(a)}),c=a._mainPanel.getValue("Rotation").split(",").map(function(a){return parseFloat(a)});a._quadScene.setMultiplaneRotation(c[0],c[1],c[2]);a._quadScene.setMultiplanePosition(b[0],b[1],b[2])});this._mainPanel.overrideStyle("Apply","width","100%");document.getElementById("Apply").parentElement.style["margin-top"]=
"0px";this._mainPanel.addButton("Reset rotation",function(){a._quadScene.setMultiplaneRotation(0,0,0)});this._mainPanel.overrideStyle("Reset rotation","width","100%");document.getElementById("Reset rotation").parentElement.style["margin-top"]="0px"};x.prototype._toggleOrientationHelper=function(){this._quadScene.getOrientationHelper().toggle()};x.prototype._toggleBoundingBoxHelper=function(){this._quadScene.getBoundingBoxHelper().toggle()};x.prototype.updateResolutionLevelUI=function(a){this._resolutionLevel=
a;this._mainPanel.setValue("Zoom level",a);this._updateResolutionDescription(this._resolutionLevel)};x.prototype.updateMultiplaneUI=function(a){var b=a.position.x.toFixed(4)+" , ",b=b+(a.position.y.toFixed(4)+" , "),b=b+a.position.z.toFixed(4);this._mainPanel.setValue("Position",b);b=a.rotation.x.toFixed(4)+" , ";b+=a.rotation.y.toFixed(4)+" , ";b+=a.rotation.z.toFixed(4);this._mainPanel.setValue("Rotation",b)};x.prototype._updateResolutionDescription=function(a,b){this._resolutionDescription=(void 0===
b?"":b)+this._quadScene.getLevelManager().getLevelInfo(a,"key");this._mainPanel.setValue("Resolution",this._resolutionDescription)};x.prototype._updateColormapList=function(){var a=this;this._mainPanel.addDropDown("Colormap",this._colormapManager.getAvailableColormaps(),function(b){a._colormapManager.useColormap(b.value)})};var z=function(a){this._size=null;this._parentElem=a;this._boundingBox3D=null};z.prototype.build=function(a){this._size=a.slice();if(!this._boundingBox3D){this._boundingBox3D=
new THREE.Object3D;a=new THREE.MeshBasicMaterial({transparent:!0,opacity:.8,color:16777215,vertexColors:THREE.FaceColors,side:THREE.BackSide});var b=new THREE.BoxGeometry(this._size[0],this._size[1],this._size[2]);b.faces[0].color.setHex(16743034);b.faces[1].color.setHex(16743034);b.faces[2].color.setHex(16724787);b.faces[3].color.setHex(16724787);b.faces[4].color.setHex(6421140);b.faces[5].color.setHex(6421140);b.faces[6].color.setHex(11008707);b.faces[7].color.setHex(11008707);b.faces[8].color.setHex(9817340);
b.faces[9].color.setHex(9817340);b.faces[10].color.setHex(35071);b.faces[11].color.setHex(35071);a=new THREE.Mesh(b,a);this._boundingBox3D.add(a);this._boundingBox3D.position.x=this._size[0]/2;this._boundingBox3D.position.y=this._size[1]/2;this._boundingBox3D.position.z=this._size[2]/2;this._boundingBox3D.children.forEach(function(a){a.layers.disable(0);a.layers.enable(1)});this._parentElem.add(this._boundingBox3D)}};z.prototype.isInside=function(a,b,c){return 0<a&&a<this._size[0]&&0<b&&b<this._size[1]&&
0<c&&c<this._size[2]};z.prototype.show=function(){this._boundingBox3D.visible=!0};z.prototype.hide=function(){this._boundingBox3D.visible=!1};z.prototype.toggle=function(){this._boundingBox3D.visible=!this._boundingBox3D.visible};z.prototype.setVisibility=function(a){this._boundingBox3D.visible=a};var w=function(a,b,c){c=void 0===c?{}:c;this._points=a;this._name=b;this._isClosed="undefined"===typeof c.isClosed?!1:c.isClosed;this._description="undefined"===typeof c.description?"":c.description;this._color=
"undefined"===typeof c.color?"#FF00FF":c.color;this._eulerAngle="undefined"===typeof c.eulerAngle?[0,0,0]:c.eulerAngle;this._scale="undefined"===typeof c.scale?[1,1,1]:c.scale;this._position="undefined"===typeof c.position?[0,0,0]:c.position;this._isValid=!1;this.validateAnnotation();this._pointRadius=.1;this._object3D=new THREE.Object3D;this._object3D.name=this._name;this._object3D.userData.description=this._description;this._object3D.userData.isClosed=this._isClosed;this._object3D.scale.set(this._scale[0],
this._scale[1],this._scale[2]);this._object3D.position.set(this._position[0],this._position[1],this._position[2]);this._object3D.rotation.set(this._eulerAngle[0],this._eulerAngle[1],this._eulerAngle[2]);this._meshMustRebuild=!0;this._buildAnnotationObject3D()};w.prototype.setPointRadius=function(a){this._pointRadius=a};w.prototype.validateAnnotation=function(){this._isValid=!0;this._isValid=this._points.length?!this._points.some(function(a){return 3!=a.length}):!1};w.prototype.addPoint=function(a){3==
a.length&&(this._points.push(a),this._meshMustRebuild=!0)};w.prototype.removePoint=function(a){this._isValid&&(this._points.splice(void 0===a?-1:a,1),this.validateAnnotation(),this._meshMustRebuild=!0)};w.prototype.getObject3D=function(){return this._object3D};w.prototype._buildPointAnnotation=function(){if(this._isValid){var a=new THREE.SphereGeometry(this._pointRadius,32,32),b=new THREE.MeshBasicMaterial,a=new THREE.Mesh(a,b);a.position.set(this._points[0][0],this._points[0][1],this._points[0][2]);
a.layers.enable(0);a.layers.enable(1);a.geometry.dynamic=!0;a.geometry.verticesNeedUpdate=!0;this._object3D.add(a);this._meshMustRebuild=!1}};w.prototype._buildLinestringAnnotation=function(){if(this._isValid){var a=new THREE.Geometry,b=new THREE.LineBasicMaterial({linewidth:2,color:new THREE.Color(this._color),blending:THREE.MultiplyBlending,depthFunc:THREE.NeverDepth});this._points.forEach(function(b){a.vertices.push(new THREE.Vector3(b[0],b[1],b[2]))});this._isClosed&&2<this._points.length&&a.vertices.push(new THREE.Vector3(this._points[0][0],
this._points[0][1],this._points[0][2]));a.computeLineDistances();b=new THREE.Line(a,b);b.layers.enable(0);b.layers.enable(1);b.geometry.dynamic=!0;b.geometry.verticesNeedUpdate=!0;this._object3D.add(b);this._meshMustRebuild=!1}};w.prototype._buildAnnotationObject3D=function(){this._isValid?this._object3D.children.length?console.warn("The object3D/mesh for this annotation is already built. Maybe use a modifying method instead."):1==this._points.length?this._buildPointAnnotation():this._buildLinestringAnnotation():
console.warn("This annotation is not valid. Possible reasons: no points OR points number of dimension is not consistant.")};w.prototype.closeLinestring=function(){};var C=function(){this._collection={};this._container3D=new THREE.Object3D;this._container3D.name="annotation collection";this._noNameIncrement=0};C.prototype.getContainer3D=function(){return this._container3D};C.prototype.addAnnotation=function(a,b,c){c=void 0===c?{}:c;b in this._collection?console.warn(b+" is already in the collection"):
(b||(b="annotation_"+this._noNameIncrement+"_"+(new Date).getMilliseconds(),this._noNameIncrement++),this._collection[b]=new w(a,b,c),this._container3D.add(this._collection[b].getObject3D()))};C.prototype.removeAnnotation=function(a){a in this._collection?this._container3D.remove(this._collection[a].getObject3D()):console.warn(a+" annotation is not in the collection. Impossible to remove.")};g=function(a,b){b=void 0===b?0:b;window.addEventListener("resize",this._updateSize.bind(this),!1);this._ready=
!1;this._counterRefresh=0;this._resolutionLevel=b;this._quadViews=[];this._onConfigFileErrorCallback=this._onReadyCallback=this._onChangeCallback=this._orientationHelper=this._planeManager=this._quadViewInteraction=null;this._colormapManager=new v;this._domContainer=document.getElementById(a);this._scene=new THREE.Scene;this._boundingBoxHelper=new z(this._scene);b=new THREE.AxisHelper(1);b.layers.enable(1);this._scene.add(b);this._scene.add(new THREE.AmbientLight(4473924));b=new THREE.DirectionalLight(16777215,
.75);b.position.set(200,200,200);b.layers.enable(0);b.layers.enable(1);this._scene.add(b);this._adjustedContainer=new THREE.Object3D;this._annotationCollection=new C;this._meshContainer=new THREE.Object3D;this._adjustedContainer.add(this._meshContainer);this._adjustedContainer.add(this._annotationCollection.getContainer3D());this._scene.add(this._adjustedContainer);this._renderer=new THREE.WebGLRenderer({antialias:!0});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(window.innerWidth,
window.innerHeight);this._domContainer.appendChild(this._renderer.domElement);this._cameraDistance=10;this._windowSize={width:0,height:0};this._stats=this._meshCollection=null;this._initPlaneManager();this._initViews(a);this._levelManager=new p;this._guiController=new x(this);this._animate()};g.prototype._initViews=function(a){var b=this,c=new f(this._scene,this._renderer,this._cameraDistance);c.initTopLeft();c.initOrthoCamera();c.useRelativeCoordinatesOf(this._planeManager.getMultiplaneContainer());
c.enableLayer(0);var d=new f(this._scene,this._renderer,this._cameraDistance);d.initTopRight();d.initOrthoCamera();d.useRelativeCoordinatesOf(this._planeManager.getMultiplaneContainer());d.enableLayer(0);var e=new f(this._scene,this._renderer,this._cameraDistance);e.initBottomLeft();e.initOrthoCamera();e.useRelativeCoordinatesOf(this._planeManager.getMultiplaneContainer());e.enableLayer(0);var g=new f(this._scene,this._renderer,this._cameraDistance);g.initBottomRight();g.initPerspectiveCamera();g.enableLayer(1);
g.disableLayer(0);g.addTrackballControl(this._render,this._domContainer);this._quadViews.push(c);this._quadViews.push(d);this._quadViews.push(e);this._quadViews.push(g);this._quadViewInteraction=new r(this._quadViews,a);this._quadViewInteraction.setMultiplaneContainer(this._planeManager.getMultiplaneContainer());this._quadViewInteraction.onClickPlane("perspective",function(a){b.setMultiplanePosition(a.x,a.y,a.z)})};g.prototype.getLevelManager=function(){return this._levelManager};g.prototype.setMultiplanePosition=
function(a,b,c){this._planeManager.setMultiplanePosition(a,b,c);this._guiController.updateMultiplaneUI(this.getMultiplaneContainerInfo())};g.prototype.setMultiplaneRotation=function(a,b,c){this._planeManager.setMultiplaneRotation(a,b,c);this._guiController.updateMultiplaneUI(this.getMultiplaneContainerInfo())};g.prototype._initPlaneManager=function(){var a=this;this._planeManager=new h(this._colormapManager,this._scene);this._planeManager.enableLayerHiRez(0);this._planeManager.disableLayerHiRez(1);
this._planeManager.enableLayerLoRez(1);this._planeManager.disableLayerLoRez(0);this._planeManager.onMultiplaneMove(function(b){a._updatePerspectiveCameraLookAt(b);a._syncOrientationHelperPosition(b)})};g.prototype.initStat=function(){this._stats=new Stats;this._domContainer.appendChild(this._stats.dom)};g.prototype._updateSize=function(){if(this._windowSize.width!=window.innerWidth||this._windowSize.height!=window.innerHeight)this._windowSize.width=window.innerWidth,this._windowSize.height=window.innerHeight,
this._quadViewInteraction.updateWindowSize(this._windowSize.width,this._windowSize.height),this._renderer.setSize(this._windowSize.width,this._windowSize.height)};g.prototype.getResolutionLevel=function(){return this._resolutionLevel};g.prototype.getColormapManager=function(){return this._colormapManager};g.prototype._animate=function(){this._render();this._stats&&this._stats.update();requestAnimationFrame(this._animate.bind(this));this._quadViews[3].updateControl()};g.prototype._render=function(){this._ready&&
(0==this._counterRefresh%30&&this._updateAllPlanesShaderUniforms(),this._counterRefresh++);this._quadViews.forEach(function(a){a.renderView()})};g.prototype.getOrientationHelper=function(){return this._orientationHelper};g.prototype.getBoundingBoxHelper=function(){return this._boundingBoxHelper};g.prototype.loadData=function(a){"precomputed_octree_tiles"==a.datatype?this._initLevelManager(a):"mesh_collection"==a.datatype?this._initMeshCollection(a):"colormap_collection"==a.datatype?this._colormapManager.loadCollection(a):
console.warn("The data to load has an unknown format.")};g.prototype._initMeshCollection=function(a){this._meshCollection=new A(a,this._meshContainer)};g.prototype._initLevelManager=function(a){var b=this;this._levelManager.loadConfig(a);this._levelManager.onReady(function(){var a=b._levelManager.getBoundingBox();b._planeManager.setLevelManager(b._levelManager);b._levelManager.setResolutionLevel(b._resolutionLevel);b._boundingBoxHelper.build(a);b._planeManager.setMultiplanePosition(a[0]/2,a[1]/2,
a[2]/2);b._initOrientationHelper(new THREE.Vector3(a[0]/2,a[1]/2,a[2]/2));b._initPlaneInteraction();b._ready=!0;b._onReadyCallback&&b._onReadyCallback(b);b._guiController.updateMultiplaneUI(b.getMultiplaneContainerInfo())});this._levelManager.onConfigError(function(a,d){b._onConfigFileErrorCallback&&b._onConfigFileErrorCallback(a,d)})};g.prototype.setResolutionLevel=function(a){console.log("--------- LVL "+a+" ---------------");this._resolutionLevel=a;this._levelManager.setResolutionLevel(this._resolutionLevel);
this._planeManager.updateScaleFromRezLvl(this._resolutionLevel);this._syncOrientationHelperScale();this._updateOthoCamFrustrum();this._guiController.updateResolutionLevelUI(a);this._onUpdateViewCallback&&this._onUpdateViewCallback(this.getMultiplaneContainerInfo())};g.prototype._updateAllPlanesShaderUniforms=function(){this._planeManager.updateUniforms()};g.prototype._updatePerspectiveCameraLookAt=function(a){this._quadViews[3].updateLookAt(a)};g.prototype._updateOthoCamFrustrum=function(){var a=
1/Math.pow(2,this._resolutionLevel);this._quadViews[0].updateOrthoCamFrustrum(a);this._quadViews[1].updateOrthoCamFrustrum(a);this._quadViews[2].updateOrthoCamFrustrum(a)};g.prototype._initOrientationHelper=function(a){this._orientationHelper=new y(this._planeManager.getWorldDiagonalHiRez()/13);this._orientationHelper.addTo(this._scene);this._syncOrientationHelperPosition(a)};g.prototype._syncOrientationHelperPosition=function(a){this._orientationHelper&&this._orientationHelper.setPosition(a)};g.prototype._syncOrientationHelperScale=
function(){this._orientationHelper.rescaleFromResolutionLvl(this._resolutionLevel)};g.prototype.onReady=function(a){this._onReadyCallback=a};g.prototype._initPlaneInteraction=function(){var a=this;this._quadViewInteraction.onGrabViewTranslate(function(b,c){var d=Math.pow(2,a._resolutionLevel);switch(c){case 0:a._planeManager.translateMultiplaneX(-b.x/d,b.y/d);break;case 1:a._planeManager.translateMultiplaneY(b.x/d,b.y/d);break;case 2:a._planeManager.translateMultiplaneZ(b.x/d,-b.y/d)}});this._quadViewInteraction.onGrabViewRotate(function(b,
c,d){switch(d){case 0:a._planeManager.rotateMultiplaneX(b*c);break;case 1:a._planeManager.rotateMultiplaneY(b*c*-1);break;case 2:a._planeManager.rotateMultiplaneZ(b*c)}});this._quadViewInteraction.onGrabViewTransverseRotate(function(b,c){var d=a._resolutionLevel/2;switch(c){case 0:a._planeManager.rotateMultiplaneZ(b.x/d);a._planeManager.rotateMultiplaneY(-b.y/d);break;case 1:a._planeManager.rotateMultiplaneX(-b.y/d);a._planeManager.rotateMultiplaneZ(b.x/d);break;case 2:a._planeManager.rotateMultiplaneX(-b.y/
d),a._planeManager.rotateMultiplaneY(b.x/d)}});this._quadViewInteraction.onArrowDown(function(b){var c=a._levelManager.getBoundingBox()[0]/a._levelManager.getLevelInfo(a._resolutionLevel,"size")[0];switch(b){case 0:a._planeManager.translateMultiplaneY(-c,0);break;case 1:a._planeManager.translateMultiplaneX(-c,0);break;case 2:a._planeManager.translateMultiplaneY(0,-c)}});this._quadViewInteraction.onArrowUp(function(b){var c=a._levelManager.getBoundingBox()[0]/a._levelManager.getLevelInfo(a._resolutionLevel,
"size")[0];switch(b){case 0:a._planeManager.translateMultiplaneY(c,0);break;case 1:a._planeManager.translateMultiplaneX(c,0);break;case 2:a._planeManager.translateMultiplaneY(0,c)}});this._quadViewInteraction.onDonePlaying(function(){a._guiController.updateMultiplaneUI(a.getMultiplaneContainerInfo());a._onUpdateViewCallback&&a._onUpdateViewCallback(a.getMultiplaneContainerInfo())})};g.prototype.getMultiplaneContainerInfo=function(){var a=this._planeManager.getMultiplanePosition(),b=this._planeManager.getMultiplaneRotation();
return{resolutionLvl:this._resolutionLevel,position:{x:a.x,y:a.y,z:a.z},rotation:{x:b.x,y:b.y,z:b.z}}};g.prototype.onUpdateView=function(a){this._onUpdateViewCallback=a};g.prototype.onConfigFileError=function(a){this._onConfigFileErrorCallback=a};g.prototype._testAnnotation=function(){this._annotationCollection.addAnnotation([[1,1,0],[1,1,1]],"my annot");console.log(this._adjustedContainer)};e.HashIO=l;e.QuadScene=g;Object.defineProperty(e,"__esModule",{value:!0})});
